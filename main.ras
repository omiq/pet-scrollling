program PET40;
@use "text/txt"
@use "output/screen"
@use "os/interrupts"
@use "input/key"

// Set the model of PET required
@projectsettings "petmodel" "4032"

var
	@define useKernal 0
	ticks: byte;
	i,s,c,a,key_press,ALIVE,WON_GAME: byte;
	x,y,old_x,old_y: byte;
	sx,sy: integer;
	player_score: integer;
	player_lives: byte;
	des,src,src2,src3,map_p: pointer;
	n_key_up,n_key_down,n_key_left,n_key_right,key_up,key_down,key_left,key_right:integer;
	irq_ad : integer at $90;
	org_ad : integer;
	new_ad: pointer;
	sdes: pointer;
	ship: cstring=(
					$7C,$FB,$EC,$62,$7B,
					$20,$FB,$EC,$FC,$FF,
					$7C,$E2,$E2,$20,$20);


map: array[9600] of byte = (
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,160,160,160,126,32,98,123,251,160,160,226,226,126,32,108,108,32,226,236,126,98,160,126,108,127,127,126,126,126,160,97,32,236,236,236,255,123,251,236,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,226,126,32,32,32,32,160,252,126,254,225,160,255,108,97,32,98,123,108,32,32,32,32,160,252,126,254,225,160,255,108,97,32,98,123,108,32,225,160,255,108,97,160,252,126,254,32,108,98,32,123,32,32,32,32,98,236,126,32,32,32,254,126,32,32,32,32,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,226,226,226,32,124,226,251,225,226,32,108,160,236,108,127,127,127,126,108,254,160,126,32,108,127,127,126,108,160,236,32,124,255,255,123,32,123,160,236,254,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,160,160,126,32,251,160,236,32,124,226,126,124,126,32,32,32,124,160,160,126,32,251,160,236,32,124,226,126,124,126,32,251,160,236,32,124,160,160,126,32,226,226,32,226,32,32,32,254,126,32,32,32,98,254,127,255,32,32,32,32,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,226,226,226,226,251,32,98,160,160,126,108,127,127,126,32,98,160,236,126,108,127,127,127,126,108,160,226,32,123,255,255,255,32,254,97,251,236,254,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,160,97,225,32,32,32,32,32,32,32,32,32,32,32,32,32,32,160,97,225,32,32,32,32,32,32,32,32,32,32,32,225,160,32,97,32,32,108,160,226,251,108,254,160,126,254,98,123,32,32,32,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,251,123,226,126,108,252,108,108,108,127,126,32,98,160,160,226,108,127,127,252,160,98,254,236,32,32,255,255,254,124,108,254,226,32,127,252,160,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,252,32,254,32,32,32,32,32,32,32,32,32,32,32,32,32,32,252,32,254,32,32,32,32,32,32,32,32,32,32,32,225,123,108,97,32,32,254,236,123,225,160,236,32,254,160,226,108,32,32,32,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,226,226,226,126,126,126,126,98,98,160,236,126,32,124,126,127,126,226,226,226,32,108,226,226,255,160,160,160,226,126,98,97,127,126,127,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,226,126,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,226,126,32,32,32,32,32,32,32,32,32,32,32,32,226,226,32,32,32,160,97,108,160,236,108,108,236,108,254,226,126,32,32,108,97,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,251,236,32,32,98,236,108,254,97,123,254,160,160,252,124,123,254,160,98,98,32,123,98,254,98,123,127,126,126,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,251,32,236,32,32,160,123,32,226,108,254,254,123,32,254,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,32,254,97,236,108,236,32,97,252,236,108,160,226,251,252,236,108,160,226,251,252,236,108,160,126,108,126,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,225,254,97,32,32,32,160,123,124,126,32,108,123,254,126,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,98,98,98,254,108,160,97,108,236,255,32,97,226,108,160,127,126,225,226,108,160,127,126,225,226,108,160,127,126,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,225,226,32,32,32,124,252,126,160,160,236,251,160,126,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,226,126,225,126,32,251,236,255,32,126,32,251,160,127,126,32,32,251,160,127,126,32,32,251,160,127,126,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,32,32,32,32,251,236,32,225,160,32,32,251,123,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,226,124,32,32,32,124,226,126,126,32,32,124,226,126,126,32,32,124,226,126,126,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,126,126,32,32,124,97,108,252,124,97,32,123,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,225,236,255,32,32,32,225,160,251,126,32,32,225,160,251,126,32,32,225,160,251,126,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,254,97,225,254,126,252,254,97,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,225,127,160,32,226,32,236,226,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,108,226,123,32,32,124,160,124,252,98,254,97,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,127,32,255,108,32,32,251,123,124,251,236,32,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,226,32,160,32,32,32,32,98,32,251,123,32,32,32,32,32,32,32,
32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,252,123,32,225,126,127,108,97,32,32,32,32,32,32,32,
32,32,32,32,32,98,160,32,32,32,32,32,32,32,32,32,32,32,98,160,236,160,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,32,32,32,32,32,32,32,32,32,32,32,98,123,32,32,32,32,32,98,160,32,32,32,32,32,32,32,32,32,32,32,98,160,236,160,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,32,32,32,32,32,32,32,32,32,32,32,98,160,236,160,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,32,32,32,32,32,32,32,32,32,32,32,98,160,236,160,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,32,32,32,32,32,32,32,32,32,32,32,98,160,236,160,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,32,32,32,32,32,32,32,32,32,32,32,98,160,236,160,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,160,98,32,127,126,254,126,32,32,32,32,32,32,32,
32,32,32,98,160,251,226,160,97,32,32,32,32,32,32,32,108,254,236,127,252,32,226,160,252,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,251,226,160,97,32,32,32,32,32,32,32,108,254,236,251,123,32,32,98,160,251,226,160,97,32,32,32,32,32,32,32,108,254,236,127,252,32,226,160,252,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,251,226,160,97,32,32,32,32,32,32,32,108,254,236,127,252,32,226,160,252,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,251,226,160,97,32,32,32,32,32,32,32,108,254,236,127,252,32,226,160,252,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,251,226,160,97,32,32,32,32,32,32,32,108,254,236,127,252,32,226,160,252,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,98,160,251,226,160,97,32,32,32,32,32,32,32,108,254,236,127,252,32,226,160,252,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,225,236,108,98,123,251,32,32,32,32,32,32,32,32,
32,108,160,160,126,225,32,124,251,160,123,32,32,108,254,254,160,127,127,251,160,32,32,32,251,97,126,32,32,32,254,252,123,32,32,32,32,32,32,32,32,108,160,160,126,225,32,124,251,160,123,32,32,108,254,254,160,127,127,251,160,127,160,160,126,225,32,124,251,160,123,32,32,108,254,254,160,127,127,251,160,32,32,32,251,97,126,32,32,32,254,252,123,32,32,32,32,32,32,32,32,108,160,160,126,225,32,124,251,160,123,32,32,108,254,254,160,127,127,251,160,32,32,32,251,97,126,32,32,32,254,252,123,32,32,32,32,32,32,32,32,108,160,160,126,225,32,124,251,160,123,32,32,108,254,254,160,127,127,251,160,32,32,32,251,97,126,32,32,32,254,252,123,32,32,32,32,32,32,32,32,108,160,160,126,225,32,124,251,160,123,32,32,108,254,254,160,127,127,251,160,32,32,32,251,97,126,32,32,32,254,252,123,32,32,32,32,32,32,32,32,108,160,160,126,225,32,124,251,160,123,32,32,108,254,254,160,127,127,251,160,32,32,32,251,97,126,32,32,32,254,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,108,126,32,124,123,252,123,32,32,32,32,32,32,
254,160,160,126,32,160,123,108,123,32,226,252,124,251,160,252,127,108,127,160,160,97,124,123,32,124,252,123,32,254,160,124,251,252,123,32,32,32,32,32,254,160,160,126,32,160,123,108,123,32,226,252,124,251,160,252,127,108,127,160,254,160,160,126,32,160,123,108,123,32,226,252,124,251,160,252,127,108,127,160,160,97,124,123,32,124,252,123,32,254,160,124,251,252,123,32,32,32,32,32,254,160,160,126,32,160,123,108,123,32,226,252,124,251,160,252,127,108,127,160,160,97,124,123,32,124,252,123,32,254,160,124,251,252,123,32,32,32,32,32,254,160,160,126,32,160,123,108,123,32,226,252,124,251,160,252,127,108,127,160,160,97,124,123,32,124,252,123,32,254,160,124,251,252,123,32,32,32,32,32,254,160,160,126,32,160,123,108,123,32,226,252,124,251,160,252,127,108,127,160,160,97,124,123,32,124,252,123,32,254,160,124,251,252,123,32,32,32,32,32,254,160,160,126,32,160,123,108,123,32,226,252,124,251,160,252,127,108,127,160,160,97,124,123,32,124,252,123,32,254,160,124,251,252,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,254,160,252,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,254,226,251,252,32,32,32,32,32,32,127,98,255,32,32,226,97,32,32,32,32,32,
160,160,252,160,225,160,252,32,127,251,123,124,251,98,124,251,252,252,160,160,160,160,123,251,252,123,32,32,225,160,160,127,32,251,160,252,32,32,32,254,160,160,252,160,225,160,252,32,127,251,123,124,251,98,124,251,252,252,160,160,160,160,252,160,225,160,252,32,127,251,123,124,251,98,124,251,252,252,160,160,160,160,123,251,252,123,32,32,225,160,160,127,32,251,160,252,32,32,32,254,160,160,252,160,225,160,252,32,127,251,123,124,251,98,124,251,252,252,160,160,160,160,123,251,252,123,32,32,225,160,160,127,32,251,160,252,32,32,32,254,160,160,252,160,225,160,252,32,127,251,123,124,251,98,124,251,252,252,160,160,160,160,123,251,252,123,32,32,225,160,160,127,32,251,160,252,32,32,32,254,160,160,252,160,225,160,252,32,127,251,123,124,251,98,124,251,252,252,160,160,160,160,123,251,252,123,32,32,225,160,160,127,32,251,160,252,32,32,32,254,160,160,252,160,225,160,252,32,127,251,123,124,251,98,124,251,252,252,160,160,160,160,123,251,252,123,32,32,225,160,160,127,32,251,160,252,32,32,32,254,123,108,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,225,160,127,124,97,32,32,32,225,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,160,32,225,160,32,32,32,32,32,98,98,123,32,98,32,32,32,32,32,32,32,32,
160,252,160,97,160,160,252,32,127,127,251,127,32,124,251,98,124,160,160,160,160,160,160,254,160,160,252,124,160,160,160,160,97,32,251,160,251,123,98,160,160,252,160,97,160,160,252,32,127,127,251,127,32,124,251,98,124,160,160,160,160,252,160,97,160,160,252,32,127,127,251,127,32,124,251,98,124,160,160,160,160,160,160,254,160,160,252,124,160,160,160,160,97,32,251,160,251,123,98,160,160,252,160,97,160,160,252,32,127,127,251,127,32,124,251,98,124,160,160,160,160,160,160,254,160,160,252,124,160,160,160,160,97,32,251,160,251,123,98,160,160,252,160,97,160,160,252,32,127,127,251,127,32,124,251,98,124,160,160,160,160,160,160,254,160,160,252,124,160,160,160,160,97,32,251,160,251,123,98,160,160,252,160,97,160,160,252,32,127,127,251,127,32,124,251,98,124,160,160,160,160,160,160,254,160,160,252,124,160,160,160,160,97,32,251,160,251,123,98,160,160,252,160,97,160,160,252,32,127,127,251,127,32,124,251,98,124,160,160,160,160,160,160,254,160,160,252,124,160,160,160,160,97,32,251,160,126,32,254,236,108,126,126,255,123,32,32,32,32,32,32,32,108,98,98,98,123,32,32,32,32,32,32,32,32,32,32,32,108,98,98,98,123,32,32,32,32,108,98,98,98,123,124,252,127,126,97,32,32,32,225,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,226,226,126,32,32,32,32,225,97,32,160,124,226,32,32,32,32,32,32,32,32,
160,160,252,160,160,160,160,252,32,127,127,251,251,251,98,124,252,98,160,160,160,160,160,252,160,160,160,160,254,160,160,160,160,225,252,160,160,160,236,160,160,160,252,160,160,160,160,252,32,127,127,251,251,251,98,124,252,98,160,160,160,160,252,160,160,160,160,252,32,127,127,251,251,251,98,124,252,98,160,160,160,160,160,252,160,160,160,160,254,160,160,160,160,225,252,160,160,160,236,160,160,160,252,160,160,160,160,252,32,127,127,251,251,251,98,124,252,98,160,160,160,160,160,252,160,160,160,160,254,160,160,160,160,225,252,160,160,160,236,160,160,160,252,160,160,160,160,252,32,127,127,251,251,251,98,124,252,98,160,160,160,160,160,252,160,160,160,160,254,160,160,160,160,225,252,160,160,160,236,160,160,160,252,160,160,160,160,252,32,127,127,251,251,251,98,124,252,98,160,160,160,160,160,252,160,160,160,160,254,160,160,160,160,225,252,160,160,160,236,160,160,160,252,160,160,160,160,252,32,127,127,251,251,251,98,124,252,98,160,160,160,160,160,252,160,160,160,160,254,160,160,160,160,225,252,236,32,254,236,254,126,32,255,32,32,32,32,32,32,32,32,108,160,251,254,127,226,123,32,32,32,32,32,32,32,32,32,108,160,251,254,127,226,123,32,32,108,160,251,254,127,226,123,252,127,126,97,32,32,32,225,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,254,226,251,252,32,32,124,252,98,236,124,226,32,32,32,32,32,32,32,32,
160,160,160,160,160,160,160,160,160,123,127,252,252,252,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,97,160,252,160,160,160,160,160,160,160,160,160,160,160,160,160,123,127,252,252,252,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,123,127,252,252,252,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,97,160,252,160,160,160,160,160,160,160,160,160,160,160,160,160,123,127,252,252,252,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,97,160,252,160,160,160,160,160,160,160,160,160,160,160,160,160,123,127,252,252,252,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,97,160,252,160,160,160,160,160,160,160,160,160,160,160,160,160,123,127,252,252,252,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,97,160,252,160,160,160,160,160,160,160,160,160,160,160,160,160,123,127,252,252,252,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,97,236,32,254,160,160,126,32,124,32,32,32,32,32,32,32,32,32,124,97,126,126,126,108,126,32,32,32,32,32,32,32,32,32,124,97,126,126,126,108,126,32,32,124,97,126,126,126,108,126,252,127,126,97,32,32,32,225,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,160,32,225,160,32,98,98,98,32,108,160,126,32,32,32,32,32,32,32,32,

);

screen_buffer: array[1000] of byte;


	procedure init_screen();
	begin
		map_p:=#map;
		fill( #screen_buffer, 0, 255 );		
		CopyFullScreen(#screen_buffer, ^$8000);
	end;
	

	procedure draw_line(i: global byte) inline;
	begin
		

		MemCpyFast(map_p, 0, des, 40 );
		map_p:=map_p+400; 
		des:=des+40;		
	end;

	
	procedure draw_screen();
	begin

		map_p:=#map+sx;
		des:=#screen_buffer;

		// Semi-"Unrolled" for extra speed	
		draw_line(0);
		draw_line(1);
		draw_line(2);
		draw_line(3);
		draw_line(4);
		draw_line(5);
		draw_line(6);
		draw_line(7);
		draw_line(8);
		draw_line(9);
		draw_line(10);
		draw_line(11);
		draw_line(12);
		draw_line(13);
		draw_line(14);
		draw_line(15);
		draw_line(16);
		draw_line(17);
		draw_line(18);
		draw_line(19);
		draw_line(20);
		draw_line(21);
		draw_line(22);
		draw_line(23);

		
	end;
	
	
	procedure draw_ship();
	var
		
	begin
		
		
		sdes := #screen_buffer+(y*40)+x;

		if (sdes[5]<>$20 or sdes[45]<>$20) then begin
			
			ALIVE:=0;
			WON_GAME:=0;	

			
		end;
	
		MemCpy(#ship, 0, sdes, 5 ); 
		sdes := sdes+40;
		MemCpy(#ship, 5, sdes, 5 );
		sdes := sdes+40;
 		MemCpy(#ship, 10, sdes, 5 ); 
		

	end;
	
	procedure draw_frame();
	begin	

		incrange(ticks,0,100);
	
		// This will run approx 60hz so we need to figure out vertical blank
		// Bit 5 is high when vertical retrace in effect
		if mod(ticks,5)=0 then begin 
			
			//incrange(sx,0,400);
			inc(sx);
			if sx=400 then sx:=0;
			
			draw_screen();	
			draw_ship();	
			CopyFullScreen(#screen_buffer, ^$8000);	
		end;
	
		
	end;
	
	procedure setup_irq();
	var
					
	begin

		// doesn't work --> org_ad:=createinteger(peek(^$91,0),peek(^$90,0));
		org_ad:=(hi(irq_ad)*256)+lo(irq_ad);		
		
		new_ad:=#draw_frame();
					
		asm("	sei	");
		irq_ad:=new_ad;
		asm("	cli	");
			
		
	end;
	
	
	procedure start_screen();
	begin
	
		txt::cls();
		txt::move_to(10,10);
		txt::print_string("PET-TYPE 2021", False);
	
		txt::clear_buffer();
		txt::wait_key();
	
	end;
	
	procedure end_screen();
	begin

		if WON_GAME then 
		begin
		
			txt::cls();
			txt::move_to(10,10);
			txt::print_string("YOU WIN!", False);

		end
		else
		begin
			
			txt::cls();
			txt::move_to(10,10);
			txt::print_string("YOU LOSE!", False);

		
		end;

		txt::clear_buffer();
		txt::wait_key();
		
	end;
	
	procedure init_game();
	begin
	
		init_screen();
		sx:=0;
		sy:=4;
		x:=0;
		y:=10;
		
		
		// The screen updates but no keyboard so disable
		//setup_irq();
		
		ALIVE:=1;
		WON_GAME:=0;
	
		
		// Numeric Keypad
		n_key_up:=Key::K8;
		n_key_down:=Key::K5;
		n_key_left:=Key::K4;
		n_key_right:=Key::K6;
		
		// Regular keys        
		key_up:=Key::KW;
		key_down:=Key::KS;
		key_left:=Key::KA;
		key_right:=Key::KD;
		
	end;
	
	procedure main_loop();
	begin
		
		
		// Andy's keyboard routine
		// doesn't work with IRQ :(
		Key::Read();


        old_x:=x;
        old_y:=y;
        if(Key::Pressed(key_up) or Key::Pressed(n_key_up)) then
        begin
            if(y>1) then
            begin
                dec(y);
                if y< 5 then sy:=sy-1;
            end;
        end;
        
        if(Key::Pressed(key_right) or Key::Pressed(n_key_right)) then
        begin
            if(x<39) then
            begin
                inc(x);
            end;
        end;
        
        if(Key::Pressed(key_down) or Key::Pressed(n_key_down)) then
        begin
            if(y<24) then
            begin
                inc(y);
                if y> 15 then sy:=sy+1;
            end;
        end;
        if(Key::Pressed(key_left) or Key::Pressed(n_key_left)) then
        begin
            if(x>0) then
            begin
                dec(x);
            end;
        end;
        
        
        // until the IRQ works will need to update screen here
        Screen_WaitVblStart();
        draw_frame();
        Screen_WaitVblEnd();
	end;

/* main program */  
begin

	while (1) do begin
		
		init_game();
		start_screen();
		
		while (ALIVE=1 and WON_GAME=0) do
		begin
	
			// where the magic happens	
			main_loop();
			
		end;
		
		end_screen();
		
	end;
end.



