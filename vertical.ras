program horizontal;
@use "text/txt"
@use "output/screen"
@use "os/interrupts"
@use "input/key"

// Set the model of PET required
@projectsettings "petmodel" "4032"

var
	@define useKernal 0
	ticks: byte;
	i,s,c,a,key_press,ALIVE,WON_GAME: byte;
	x,y,old_x,old_y: byte;
	sx,sy: integer;
	player_score: integer;
	player_lives: byte;
	des,src,src2,src3,map_p: pointer;
	n_key_up,n_key_down,n_key_left,n_key_right,key_up,key_down,key_left,key_right:integer;
	irq_ad : integer at $90;
	org_ad : integer;
	new_ad: pointer;
	sdes: pointer;
	ship: cstring=(

,$20,$E9,$DF,$20,
,$E9,$DA,$DA,$DF,
,$69,$5F,$69,$5F,
);



map: array[8000] of byte = (
160,160,160,160,160,160,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,160,160,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,160,160,160,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,160,160,160,236,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,160,160,160,160,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,160,160,160,160,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,160,160,160,160,160,160,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,160,160,160,160,160,160,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,160,236,252,124,160,160,160,252,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,160,160,160,160,236,254,254,252,160,160,160,97,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,160,255,160,160,236,225,254,254,160,160,32,252,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,97,254,254,160,236,108,255,254,123,255,123,98,254,254,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
236,123,255,254,126,32,123,255,123,255,123,254,254,160,254,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
236,123,255,123,123,123,254,255,255,255,254,255,254,254,97,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
123,255,255,123,98,160,254,254,255,255,255,254,255,254,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
255,123,255,123,236,254,254,254,123,32,225,254,160,123,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
255,255,98,254,98,98,98,254,254,98,255,254,255,32,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
225,254,160,160,160,254,254,254,160,236,254,124,32,32,32,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
255,255,254,236,255,255,254,254,123,255,32,32,32,32,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
254,254,160,97,32,254,160,236,32,32,32,32,32,32,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
98,255,254,126,32,32,225,98,32,32,32,32,32,32,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
160,160,32,32,32,32,160,254,97,32,32,32,32,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
98,123,32,32,32,255,254,255,32,32,108,98,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,160,160,160,160,
160,254,32,32,124,255,255,32,32,32,160,254,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,160,160,160,160,160,
254,123,32,32,255,255,32,32,123,254,255,254,97,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,160,160,160,160,160,
255,32,32,32,123,32,32,255,255,255,254,254,97,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,160,160,160,160,160,160,
32,32,32,32,32,123,32,255,123,255,254,160,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,160,160,160,160,160,160,
32,32,123,32,32,32,123,123,123,255,254,254,160,254,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,160,160,160,160,160,160,160,
32,32,32,32,32,32,32,123,123,254,254,254,254,236,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,160,160,160,160,160,160,160,
32,32,32,32,32,32,32,32,255,255,255,255,255,123,98,98,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,160,160,160,160,160,160,160,160,
32,32,32,32,32,32,32,32,123,255,123,255,123,254,254,160,97,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,160,160,160,160,160,160,160,160,
32,32,32,32,32,32,32,32,255,123,255,254,160,255,254,236,108,123,32,32,32,32,32,32,32,123,123,123,255,255,255,236,160,160,160,160,160,160,160,160,
32,32,32,32,32,32,32,32,108,255,254,160,254,236,123,98,254,160,32,32,32,32,32,32,32,123,123,123,255,255,254,254,160,160,160,160,160,160,160,160,
32,32,32,32,108,160,123,108,126,32,254,254,97,123,123,254,160,123,32,32,32,32,32,32,32,123,123,123,255,255,254,160,160,160,160,160,160,160,160,160,
32,32,108,160,254,160,98,32,32,108,160,254,123,123,123,254,255,123,32,32,32,32,32,32,32,123,123,123,255,255,254,160,160,160,160,160,160,160,160,160,
32,32,254,254,252,254,160,98,32,254,160,236,254,123,123,255,255,123,32,32,32,32,32,32,32,123,123,123,255,254,160,160,160,160,160,160,160,160,160,160,
32,32,255,254,255,160,255,254,255,254,255,255,255,123,123,255,255,32,32,32,32,32,32,32,32,123,123,123,254,160,160,160,160,160,160,160,160,160,160,160,
123,255,254,255,254,254,254,255,255,255,255,123,255,123,123,123,255,32,32,32,32,32,32,32,32,123,123,123,254,160,160,160,160,160,160,254,160,160,160,160,
123,255,123,255,255,255,255,255,255,255,255,123,123,123,123,123,123,32,32,32,32,32,32,32,32,123,123,123,160,160,160,160,160,160,160,160,160,254,255,160,
123,32,255,123,254,255,255,255,255,123,255,123,123,123,123,123,123,32,32,32,32,32,32,32,32,123,123,98,160,160,160,160,160,160,160,160,160,255,254,254,
32,124,123,255,255,255,123,255,255,255,123,123,32,123,32,123,123,32,32,32,32,32,32,32,32,123,98,160,160,160,160,160,254,160,160,160,160,160,255,255,
32,123,123,255,254,255,255,123,255,123,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,98,160,160,160,160,254,160,160,254,254,160,160,160,160,255,
32,123,32,254,254,123,123,123,255,123,123,123,32,254,252,123,32,32,32,32,32,32,32,32,108,254,160,160,236,160,160,254,160,255,255,160,254,160,160,252,
123,32,254,160,255,123,255,123,123,123,255,123,123,160,160,97,32,32,32,32,32,32,32,32,108,160,160,160,160,254,236,160,160,97,255,255,160,160,160,160,
32,32,255,254,123,123,123,123,32,123,123,254,252,225,255,98,32,32,32,32,32,32,32,32,160,160,160,160,160,160,160,160,160,160,123,123,124,251,160,160,
123,124,254,255,123,123,123,123,123,254,160,160,160,123,254,255,32,32,32,32,32,32,32,251,160,160,160,160,160,255,160,160,160,160,160,123,123,32,225,160,
32,255,123,123,123,123,123,98,123,160,254,160,254,123,255,255,123,32,32,32,32,32,108,160,160,160,160,160,254,255,255,236,251,160,160,160,98,32,32,160,
32,123,255,32,123,123,123,160,160,254,254,254,254,123,255,255,123,32,32,32,32,32,225,160,160,160,255,160,160,255,255,123,123,236,98,160,236,32,32,32,
32,123,32,123,123,123,123,254,254,160,255,255,255,255,255,255,123,32,32,32,32,124,160,160,160,236,97,255,160,254,98,123,123,123,124,254,97,225,123,32,
123,123,123,123,123,254,160,254,254,254,254,255,255,255,255,255,255,32,32,32,32,108,160,160,160,160,254,254,225,236,254,160,255,123,123,124,97,124,254,123,
32,123,123,123,225,160,254,255,255,254,255,255,123,255,123,255,255,32,32,32,32,225,160,160,252,160,254,254,225,236,255,254,123,32,32,32,32,255,124,254,
123,123,123,32,255,254,254,254,254,255,255,255,255,255,254,255,32,32,32,32,32,124,160,160,160,160,160,254,255,236,254,255,254,32,123,32,32,32,254,255,
123,32,32,255,255,254,255,254,236,255,255,123,255,254,254,160,32,32,32,32,32,32,160,160,160,160,255,254,32,236,255,255,123,255,255,123,32,32,254,255,
32,32,254,254,255,254,255,255,255,255,254,123,254,254,254,97,32,32,32,32,32,32,225,251,160,236,255,255,254,255,255,255,123,255,255,32,123,32,124,255,
108,254,254,254,123,123,255,255,255,254,123,255,255,255,123,123,32,32,32,32,32,32,255,160,160,252,255,255,123,255,123,254,123,123,123,225,123,32,32,225,
254,254,236,254,255,123,236,123,255,32,123,255,255,255,123,123,32,32,32,32,32,32,32,226,127,126,123,123,255,123,123,255,123,123,123,225,254,123,32,124,
254,255,123,254,254,255,123,32,32,32,32,123,123,123,123,123,32,32,32,32,32,32,32,126,226,123,32,123,123,123,123,254,98,123,32,225,254,97,123,32,
236,255,255,123,255,255,32,32,32,255,255,123,123,123,123,123,32,32,32,32,32,32,32,124,127,236,123,255,254,255,254,254,160,97,32,225,160,123,32,32,
255,123,123,123,124,123,32,32,123,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,124,254,32,254,254,32,254,254,254,252,32,124,255,32,32,32,
160,123,32,123,123,32,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,124,32,225,254,254,225,160,254,254,123,32,32,32,32,32,32,
124,123,32,123,98,98,255,254,123,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,32,124,254,255,254,254,236,255,32,32,32,32,32,32,32,
123,32,123,254,160,255,254,123,255,255,160,123,123,123,123,123,32,32,32,32,32,32,32,32,32,32,225,255,254,254,236,255,254,32,32,32,32,32,32,32,
98,254,254,255,124,255,123,255,123,255,255,160,123,123,123,123,32,32,32,32,32,32,32,32,32,123,255,255,254,160,32,124,32,32,32,32,32,32,32,32,
160,160,160,254,123,32,255,123,255,124,254,160,160,123,123,123,32,32,32,32,32,32,32,32,32,254,160,160,255,32,32,32,32,32,32,32,32,32,32,108,
160,160,160,255,123,32,32,123,32,123,124,254,160,252,123,123,32,32,32,32,32,32,32,32,32,255,254,255,98,32,32,32,32,32,32,32,32,108,123,160,
160,160,160,160,32,32,32,32,108,32,123,225,254,160,123,123,32,32,32,32,32,32,32,32,32,123,236,255,254,123,32,32,32,32,32,32,32,160,160,254,
160,160,160,160,252,32,32,32,255,255,123,123,108,160,97,123,32,32,32,32,32,32,32,32,32,123,255,255,123,32,32,32,32,32,32,108,98,251,254,160,
160,160,160,160,160,123,108,254,254,255,255,255,123,160,160,123,32,32,32,32,32,32,32,32,32,123,123,255,254,98,32,32,32,32,32,160,160,236,254,255,
160,160,160,160,236,236,255,254,255,254,254,255,255,255,160,97,32,32,32,32,32,32,32,32,32,123,123,255,254,236,32,32,32,32,32,124,255,254,124,255,
160,160,160,236,254,255,254,254,32,124,97,160,254,255,254,160,123,32,32,32,32,32,32,32,32,123,123,123,123,32,32,32,32,254,160,123,254,255,32,124,
160,160,252,255,255,254,160,160,98,32,32,124,97,255,254,160,97,32,32,32,32,32,32,32,32,123,123,123,123,32,32,32,32,251,254,98,32,255,123,32,
160,160,160,255,255,160,160,160,160,252,123,123,254,98,160,160,252,32,32,32,32,32,32,32,32,123,123,123,123,32,32,32,32,32,251,255,123,32,123,123,
160,160,236,254,123,160,160,254,254,160,97,123,123,255,160,160,160,123,32,32,32,32,32,32,32,123,123,123,255,123,32,32,32,32,124,255,255,32,32,32,
252,255,254,254,252,254,160,236,254,236,255,123,255,123,255,160,160,97,32,32,32,32,32,32,32,123,123,123,255,255,123,32,32,32,32,32,123,123,32,32,
254,254,255,160,255,254,254,255,255,236,123,255,124,255,255,254,254,97,32,32,32,32,32,32,32,123,123,123,255,255,123,32,32,32,32,32,32,123,32,32,
160,254,255,255,255,254,97,124,255,255,254,32,124,255,160,254,160,160,123,32,32,32,32,32,32,123,123,123,255,255,255,123,32,32,32,32,32,32,32,32,
255,254,254,123,32,255,123,255,123,254,255,32,32,255,255,254,254,97,32,32,32,32,32,32,32,123,123,123,255,255,255,255,98,32,108,160,32,123,32,32,
255,255,255,32,32,123,255,123,123,254,254,32,255,255,255,255,97,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,123,124,236,32,123,123,32,
123,255,32,32,255,123,123,255,98,160,32,123,123,255,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,160,254,32,123,32,32,
255,32,32,32,254,123,225,254,236,32,123,32,32,32,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,160,254,123,32,32,32,
255,32,32,123,124,32,124,124,32,32,32,32,123,32,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,123,32,32,32,
32,32,32,32,32,32,32,32,32,123,32,98,160,123,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,255,254,123,32,32,
32,32,32,32,32,32,32,32,255,123,123,160,254,32,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,255,123,123,32,32,
32,255,32,32,32,32,255,255,255,123,123,255,254,32,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,123,32,123,32,
32,32,32,32,32,123,123,255,123,123,124,255,255,32,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,123,32,32,108,
32,108,123,32,255,123,255,123,255,32,255,255,32,32,32,254,252,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,123,32,32,
124,126,126,32,32,254,254,254,32,123,32,32,32,32,254,254,254,160,123,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,252,32,32,
126,126,108,32,98,254,160,160,97,32,254,123,32,124,254,255,254,254,126,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,123,32,
127,126,251,127,225,251,126,124,32,98,255,254,32,255,255,254,254,123,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,123,32,
127,251,127,127,127,126,32,126,255,255,254,123,255,123,255,254,255,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,97,32,
251,251,251,127,251,126,126,226,123,255,255,32,32,254,255,254,255,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,123,
127,251,127,251,127,126,126,126,255,255,32,32,255,255,254,254,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,32,
251,127,251,127,127,126,127,126,123,32,32,32,225,255,255,108,123,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,225,
127,251,126,127,127,127,127,126,32,126,32,108,127,226,98,254,160,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,254,
127,226,126,126,251,127,127,126,126,126,251,127,251,127,124,225,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,255,
126,127,32,225,126,251,126,126,126,126,126,127,127,127,126,126,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
127,126,251,126,108,126,127,32,127,126,126,126,127,127,127,32,126,32,108,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
97,255,255,123,32,126,32,251,126,32,32,32,108,126,126,127,126,32,126,126,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
123,255,123,32,108,126,251,127,251,127,160,126,251,126,126,127,251,126,126,126,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,160,160,160,160,160,
254,124,32,32,32,126,98,127,126,251,251,126,32,126,32,126,126,127,126,126,32,32,32,32,32,123,123,123,255,255,255,255,255,98,236,160,160,160,160,160,
32,32,32,32,32,32,124,126,126,127,251,126,127,108,127,32,127,126,126,126,127,32,32,32,32,123,123,123,255,255,255,255,254,160,255,255,255,160,160,160,
32,32,32,32,32,32,32,126,126,126,126,127,126,126,126,251,251,126,32,32,126,126,32,32,32,123,123,123,255,255,255,255,254,254,236,255,255,255,254,123,
32,32,32,32,32,32,123,32,127,32,126,127,126,127,32,251,251,126,32,32,126,126,32,32,32,123,123,123,255,255,255,255,255,255,255,98,123,123,255,123,
32,32,32,32,98,254,32,124,126,32,126,127,32,126,32,251,127,127,32,108,126,126,32,32,32,123,123,123,255,255,254,255,255,255,255,255,236,123,255,123,
32,32,123,255,255,255,32,32,32,98,126,32,32,123,123,98,251,251,127,127,127,126,32,32,32,123,123,123,255,255,255,254,255,255,123,255,123,255,123,123,
32,32,255,255,255,123,32,32,255,32,126,32,123,123,98,254,127,127,32,127,32,126,32,32,32,123,123,123,255,255,160,254,255,123,255,255,254,255,255,255,
32,123,123,254,32,32,32,255,32,32,32,123,32,254,255,254,251,126,127,127,126,32,32,32,32,123,123,123,255,255,254,123,32,123,123,255,255,32,255,254,
32,123,255,32,32,108,255,32,32,32,123,123,32,254,226,32,32,126,32,32,126,32,32,32,32,123,123,123,255,98,255,123,123,32,254,255,254,108,255,160,
32,32,123,32,124,32,32,32,32,32,32,32,108,126,226,32,32,32,32,32,32,32,32,32,32,123,123,123,255,254,160,97,32,32,254,254,254,160,225,254,
32,32,32,32,32,32,32,32,32,32,32,108,126,32,126,97,32,32,32,32,32,32,32,32,32,123,123,123,255,160,160,32,123,123,160,254,160,236,255,123,
32,32,32,32,32,32,32,32,32,123,124,126,126,126,127,123,32,32,32,32,32,32,32,32,32,123,123,123,255,160,160,254,123,254,254,254,255,255,255,255,
32,32,32,32,32,32,32,32,254,108,126,251,126,126,126,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,236,160,160,254,254,160,236,225,254,254,
32,32,32,32,32,123,254,225,127,126,127,127,126,126,97,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,236,254,254,254,255,254,254,160,254,236,
32,32,32,123,123,108,127,127,127,126,108,97,123,97,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,32,254,160,254,254,254,160,160,160,254,
32,123,123,123,252,251,160,127,127,252,160,97,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,254,254,254,255,254,254,124,124,32,254,254,
160,255,225,160,251,160,127,160,160,160,160,97,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,160,160,254,255,255,32,32,98,123,254,254,
254,225,160,160,160,160,160,160,160,160,160,252,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,254,255,255,32,225,254,254,255,254,
32,251,251,160,160,160,160,160,160,160,160,160,252,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,254,254,255,32,254,160,254,254,254,
126,160,160,160,160,160,160,236,160,160,160,160,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,254,254,123,32,254,255,254,254,254,
254,160,160,160,160,160,236,98,254,160,160,160,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,254,160,123,32,254,254,255,160,236,
160,160,160,236,160,160,126,254,255,254,160,160,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,98,32,160,254,126,254,252,
160,160,236,254,160,160,123,124,254,255,160,255,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,123,160,160,32,160,254,
255,160,123,254,255,254,32,32,255,255,255,254,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,124,254,160,254,254,
254,123,255,255,254,123,254,254,255,123,254,160,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,98,251,255,254,255,
255,255,123,236,123,255,254,160,123,255,255,254,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,98,124,123,254,
254,123,255,254,236,255,160,254,32,255,254,255,97,255,123,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,123,123,225,
255,255,123,255,123,255,255,255,32,255,255,255,236,255,255,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,123,254,
254,255,255,123,255,255,254,32,32,254,254,254,236,255,255,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,252,32,
255,255,123,255,255,255,123,32,32,254,255,160,123,255,123,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,32,
254,254,254,255,255,123,123,32,32,254,254,255,255,123,123,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,32,
254,254,254,123,123,123,123,123,32,160,254,255,123,123,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,97,
160,255,254,32,255,123,124,123,255,123,255,254,123,123,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,252,
32,32,32,123,123,123,32,124,123,254,123,32,32,123,32,32,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
32,32,32,32,255,32,32,32,124,254,254,123,123,32,32,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
32,32,32,32,32,32,32,32,32,124,255,255,32,32,32,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
32,254,252,32,254,123,108,123,32,32,32,32,32,32,32,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
32,160,254,254,160,160,160,160,32,98,32,32,32,32,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
32,254,254,254,160,254,160,254,225,160,252,160,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,160,160,
124,255,254,254,255,255,255,255,255,254,254,160,97,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,236,97,
255,255,254,255,255,255,255,32,254,255,254,254,160,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,160,254,254,
255,255,32,255,255,255,32,255,255,255,254,225,254,97,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,127,254,254,
255,123,123,123,255,32,255,32,255,255,32,255,160,97,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,126,254,254,254,
123,123,32,123,32,123,32,32,32,32,255,254,255,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,160,160,127,123,255,255,255,
123,32,123,32,32,32,32,32,32,255,254,255,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,254,160,160,160,97,255,255,255,254,254,
32,123,32,32,32,32,32,32,123,255,254,98,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,254,160,160,236,97,32,255,255,254,32,255,
123,32,32,32,32,32,32,123,255,254,160,160,97,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,160,160,236,255,123,255,255,255,97,255,98,
32,32,32,32,32,32,32,123,255,236,254,255,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,160,126,254,254,123,123,255,123,123,255,255,
32,32,123,32,32,32,123,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,160,254,254,254,123,255,123,123,123,255,32,
254,97,32,32,32,32,32,123,123,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,160,32,251,255,123,98,255,255,254,123,98,
160,126,32,32,123,32,32,123,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,254,160,32,236,123,255,160,160,254,254,254,254,
32,32,32,32,32,32,32,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,254,160,255,32,98,160,254,255,32,255,124,255,
32,32,32,32,32,32,98,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,254,236,32,123,160,254,160,32,255,255,255,255,
32,32,32,123,32,123,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,32,254,254,255,160,32,123,123,255,123,255,
32,32,254,123,123,108,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,32,254,254,254,255,108,255,255,254,255,123,32,
32,254,254,98,123,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,254,254,255,32,160,255,123,124,255,32,32,
98,160,160,160,97,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,254,160,160,160,123,254,254,236,32,32,32,32,32,
160,254,254,160,160,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,255,254,160,254,97,32,236,32,32,32,32,32,32,
160,160,254,254,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,160,160,254,32,32,32,32,32,32,98,32,
236,254,255,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,123,251,254,254,32,32,32,32,32,225,254,252,
160,254,254,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,160,160,123,32,32,32,32,225,160,255,
160,254,254,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,225,160,123,32,32,32,32,124,254,123,
160,254,254,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,123,226,32,32,32,32,108,160,160,123,
254,254,160,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,254,252,32,32,108,160,160,160,255,
254,254,160,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,160,160,123,32,225,160,254,160,123,
254,160,160,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,255,255,123,32,254,160,255,123,
160,254,160,160,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,255,255,123,254,255,255,255,
254,254,160,160,160,160,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,123,123,255,255,123,255,
160,254,160,160,160,160,160,160,254,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,123,123,123,255,123,123,
254,252,160,226,251,160,160,160,160,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,123,32,255,255,254,
160,160,160,254,98,255,251,160,160,160,236,97,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,160,252,123,32,255,255,
254,236,254,160,255,254,254,254,160,160,160,98,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,123,32,32,255,
160,236,255,254,226,160,160,160,160,254,251,160,252,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,255,254,123,32,124,
160,160,123,255,255,255,255,255,254,160,98,255,98,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,255,255,252,32,32,
160,255,255,123,254,254,254,255,255,254,236,254,160,97,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,255,123,255,252,32,
124,225,254,255,254,254,254,255,123,254,123,254,254,160,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,123,32,225,123,
32,254,255,254,160,255,160,254,255,123,236,254,254,254,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,98,32,32,126,
225,236,255,254,254,160,255,254,123,123,255,254,255,254,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,254,97,32,32,
32,255,254,255,254,255,254,254,252,98,254,255,255,254,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,254,254,255,123,123,32,
123,123,254,254,255,254,124,254,160,160,160,255,255,123,32,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,160,255,255,123,123,123,123,
255,254,160,255,254,255,123,254,254,254,254,255,255,123,32,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,236,123,255,255,255,98,
255,254,255,254,255,123,123,255,254,160,255,254,255,32,32,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,254,255,254,254,160,254,236,
32,254,255,32,123,123,98,254,254,254,160,254,236,32,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,255,255,255,254,254,254,123,
32,124,32,32,32,98,32,225,255,254,254,236,32,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,254,160,254,254,255,123,255,254,98,254,160,
32,32,32,32,124,32,123,255,254,254,236,32,32,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,254,160,255,236,255,255,123,255,254,254,236,
32,32,32,32,32,123,123,255,254,98,32,32,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,124,255,98,254,255,123,123,160,32,32,
98,254,32,32,123,32,254,254,160,255,32,32,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,255,255,255,254,255,254,98,123,32,252,32,
255,255,32,32,32,123,255,254,254,254,98,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,255,123,123,255,123,255,254,160,123,32,225,123,
255,32,32,108,108,123,32,32,254,254,236,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,254,123,255,254,255,123,255,254,252,32,32,108,
32,32,108,32,160,226,123,255,255,225,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,123,255,123,254,123,123,32,254,254,97,32,32,
32,123,123,255,32,123,255,123,108,254,160,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,98,254,255,255,255,254,123,123,32,160,254,32,32,
254,32,32,123,32,123,32,32,255,254,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,98,255,254,225,254,254,98,123,32,124,255,123,32,
236,32,123,123,32,32,123,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,254,254,254,254,254,236,254,254,123,32,32,123,32,
32,123,32,32,32,255,123,255,255,254,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,254,254,254,255,255,98,255,255,32,32,32,32,255,
123,123,254,32,123,123,254,255,254,254,160,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,254,160,160,160,254,160,160,32,32,32,32,32,32,
123,123,32,32,32,255,255,254,254,255,236,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,124,254,160,124,126,251,254,123,32,32,123,32,32,
32,32,32,32,123,123,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,160,254,32,32,124,255,254,123,255,254,98,32,
32,32,32,32,32,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,254,160,123,108,160,236,255,123,255,254,255,98,
32,32,32,108,254,254,254,255,255,255,255,123,123,123,123,123,32,32,32,32,32,32,32,32,32,123,123,123,254,254,97,124,160,254,255,123,255,254,255,255,
);


screen_buffer: array[1000] of byte;


	procedure init_screen();
	begin
		map_p:=#map;
		fill( #screen_buffer, 0, 255 );		
		CopyFullScreen(#screen_buffer, ^$8000);
	end;
	

	procedure draw_line(i: global byte) inline;
	begin
		

		MemCpyFast(map_p, 0, des, 40 );
		map_p:=map_p+40; 
		des:=des+40;		
	end;

	
	procedure draw_screen();
	begin

		map_p:=#map+(sy*40);
		des:=#screen_buffer;

		// Semi-"Unrolled" for extra speed	
		draw_line(0);
		draw_line(1);
		draw_line(2);
		draw_line(3);
		draw_line(4);
		draw_line(5);
		draw_line(6);
		draw_line(7);
		draw_line(8);
		draw_line(9);
		draw_line(10);
		draw_line(11);
		draw_line(12);
		draw_line(13);
		draw_line(14);
		draw_line(15);
		draw_line(16);
		draw_line(17);
		draw_line(18);
		draw_line(19);
		draw_line(20);
		draw_line(21);
		draw_line(22);
		draw_line(23);

		
	end;
	
	
	procedure draw_ship();
	var
		
	begin
		
		
		sdes := #screen_buffer+(y*40)+x;
/*
		if (sdes[5]<>$20 or sdes[45]<>$20) then begin
			
			ALIVE:=0;
			WON_GAME:=0;	

			
		end;
	*/
		MemCpy(#ship, 0, sdes, 5 ); 
		sdes := sdes+40;
		MemCpy(#ship, 5, sdes, 5 );
		sdes := sdes+40;
 		MemCpy(#ship, 10, sdes, 5 ); 
		

	end;
	
	procedure draw_frame();
	begin	

	//	incrange(ticks,0,100);
	
		// This will run approx 60hz so we need to figure out vertical blank
		// Bit 5 is high when vertical retrace in effect
//		if mod(ticks,5)=0 then begin 
			
			//incrange(sx,0,400);
			dec(sy);
			if sy=0 then sy:=200-24;
			
			draw_screen();	
			draw_ship();	
			CopyFullScreen(#screen_buffer, ^$8000);	
//		end;
	
		
	end;
	
	procedure setup_irq();
	var
					
	begin

		// doesn't work --> org_ad:=createinteger(peek(^$91,0),peek(^$90,0));
		org_ad:=(hi(irq_ad)*256)+lo(irq_ad);		
		
		new_ad:=#draw_frame();
					
		asm("	sei	");
		irq_ad:=new_ad;
		asm("	cli	");
			
		
	end;
	
	
	procedure start_screen();
	begin
	
		txt::cls();
		txt::move_to(10,10);
		txt::print_string("PET-TYPE 2021", False);
	
		txt::clear_buffer();
		txt::wait_key();
	
	end;
	
	procedure end_screen();
	begin

		if WON_GAME then 
		begin
		
			txt::cls();
			txt::move_to(10,10);
			txt::print_string("YOU WIN!", False);

		end
		else
		begin
			
			txt::cls();
			txt::move_to(10,10);
			txt::print_string("YOU LOSE!", False);

		
		end;

		txt::clear_buffer();
		txt::wait_key();
		
	end;
	
	procedure init_game();
	begin
	
		init_screen();
		sx:=0;
		sy:=200-24;
		x:=10;
		y:=10;
		
		
		// The screen updates but no keyboard so disable
		//setup_irq();
		
		ALIVE:=1;
		WON_GAME:=0;
	
		
		// Numeric Keypad
		n_key_up:=Key::K8;
		n_key_down:=Key::K5;
		n_key_left:=Key::K4;
		n_key_right:=Key::K6;
		
		// Regular keys        
		key_up:=Key::KW;
		key_down:=Key::KS;
		key_left:=Key::KA;
		key_right:=Key::KD;
		
	end;
	
	procedure main_loop();
	begin
		
		
		// Andy's keyboard routine
		// doesn't work with IRQ :(
		Key::Read();


        old_x:=x;
        old_y:=y;
        if(Key::Pressed(key_up) or Key::Pressed(n_key_up)) then
        begin
            if(y>1) then
            begin
                dec(y);
            end;
        end;
        
        if(Key::Pressed(key_right) or Key::Pressed(n_key_right)) then
        begin
            if(x<39) then
            begin
                inc(x);
            end;
        end;
        
        if(Key::Pressed(key_down) or Key::Pressed(n_key_down)) then
        begin
            if(y<24) then
            begin
                inc(y);
            end;
        end;
        if(Key::Pressed(key_left) or Key::Pressed(n_key_left)) then
        begin
            if(x>0) then
            begin
                dec(x);
            end;
        end;
        
        
        // until the IRQ works will need to update screen here
        Screen_WaitVblStart();
        draw_frame();
        Screen_WaitVblEnd();
	end;

/* main program */  
begin

	while (1) do begin
		
		init_game();
		start_screen();
		
		while (ALIVE=1 and WON_GAME=0) do
		begin
	
			// where the magic happens	
			main_loop();
			
		end;
		
		end_screen();
		
	end;
end.



